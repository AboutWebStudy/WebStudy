## 체인지 버퍼

- 인덱스를 업데이트할 때 사용하는 임시 메모리 공간을 체인지 버퍼(Change Buffer)라고 한다.
- 체인지 버퍼에 임시로 저장된 인덱스 레코드 조각은 이후 백그라운드 스레드에 의해 병합되는데 이를 버퍼 머지 스레드(Merge thread)라고 한다.
- INSERT, DELETE, UPDATE로 인해 키를 추가하거나 삭제하는 작업은 모두 버퍼링이 된다.

이 체인지 버퍼 작업을 종류별로 활성화할 수도 있다.

**innodb_change_buffering**

- all : 모든 인덱스 관련 작업
- none : 버퍼링 x
- inserts : 인덱스에 새로운 아이템을 추가하는 작업만 버퍼링
- deletes : 인덱스에서 기존 아이템을 삭제하는 작업만 버퍼링
- changes : 인덱스에 추가하고 삭제하는 작업만 버퍼링
- purges : 인덱스 아이템을 영구적으로 삭제하는 작업만 버퍼링

체인지 버퍼는 기본적으로 25%까지만 사용할 수 있게 설정되어 있고,`innodb_change_buffer_max_size` 변수를 통해 설정이 가능하다.

## 리두 로그 및 로그 버퍼

리두 로그는 트랜잭션의 4가지 요소인 ACID 중에서 D(Durable)에 해당하는 영속성과 가장 밀접하게 연관돼 있다. 이유는 서버가 비정상적으로 종료됐을 때 데이터 파일에 기록되지 못한 데이터를 잃지 않게 해주는 안전장치이기 때문이다.

MySQL 서버가 비정상 종료되었을 때 InnoDB 스토리지 엔진의 데이터 파일은 다음과 같은 두 가지 종류의 일관되지 않은 데이터를 가질 수 있다.

- 커밋 됐지만 데이터 파일에 기록되지 않은 데이터
- 롤백 됐지만 데이터 파일에 이미 기록된 데이터

첫 번째 경우는 리두 로그에 저장된 데이터를 데이터 파일에 다시 복사하면 되고, 두번째의 경우는 변경되기 전 데이터를 가진 언두 로그의 내용을 가져와 데이터 파일에 복사하면 된다.

리두 로그를 어느 주기로 디스크에 동기화할지를 결정하는 `innodb_flush_log_at_trx_commit` 변수가 있는데 옵션은 0, 1, 2로

- 0 : 1초에 한번 디스크에 기록 및동기화
- 1 : 트랜잭션이 커밋될 때마다 디스크에 기록 및 동기화
- 2 : 커밋될 때마다 디스크로 기록은 하지만 동기화는 1초에 한번

이 있다.

### 리두 로그 아카이빙

8.0 버전부터 InnoDB 스토리지 엔진의 리두 로그를 아카이빙할 수 있는 기능이 추가됐다. MySQL 엔터프라이즈 백업이나 Xtrabackup 툴은 데이터 파일을 복사하는 동안 InnoDB 스토리지 엔진의 리두 로그에 쌓인 내용을 계속 추적하면서 새로 추가된 리두 로그 엔트리를 복사하며, 오류 추적이 가능해졌다.

## 어댑티브 해시 인덱스

InnoDB 스토리지 엔진에서 사용자가 자주 요청하는 데이터에 대해 자동으로 생성하는 인덱스이며, `innodb_adaptive_hash_index` 시스템 변수를 이용해 설정할 수 있다.

자주 사용되는 요청을 인덱스화 한다면 추가적으로 다른 데이터도 처리가 더 빨라질 것이다.

해당 인덱스를 사용해야 할 여부는 아래와 같은 상태를 고려하며 결정해야 할 것이다.

- 디스크의 데이터가 InnoDB 버퍼 풀 크기와 비슷한 경우
- 동등 조건 검색이 많은 경우
- 쿼리가 데이터 중에서 일부 데이터에만 집중하는 경우
