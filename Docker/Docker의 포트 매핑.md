### 👉 포트 매핑이란?

---

- 포트 매핑은 Docker 컨테이너 내부의 특정 서비스(예 : 웹 서버, 데이터베이스 등)에 외부에서 접근할 수 있도록 컨테이너 내부 포트와 호스트(컴퓨터) 포트를 연결하는 작업
- 쉽게 말해, 컨테이너 안에서만 작동하는 프로그램을 외부에서 접근 가능하게 만들어주는 것
- 포트 매핑이 설정되면 Docker는 NAT(Network Address Translation) 기술을 사용해 호스트 포트에서 들어오는 요청을 브리지 네트워크 내부의 컨테이너 포트로 전달
    - NAT는 외부에서 들어오는 요청을 컨테이너 내부로 안전하게 라우팅해주는 역할
    <br>
    <br>

### 👉 왜 포트 매핑이 필요한가?

---

- Docker 컨테이너는 기본적으로 외부와 격리되어 있음
- 그러다 보니, 컨테이너 내부에서 실행되는 프로그램에 외부에서 바로 접근할 수 없음
- 예를 들어, 웹 서버가 컨테이너의 80번 포트에서 서비스 중이라도, 외부에서는 이 포트에 직접 접근할 수 없기 때문에 포트 매핑을 통해 외부와 연결하는 통로를 만들어줘야 함
<br>
<br>

### 👉 포트 매핑 예시

---

```docker
docker run -p <호스트 포트>:<컨테이너 포트> <이미지 이름>
```

- 포트 매핑은 `-p` 옵션을 사용하여 설정할 수 있음
<br>

- 예시
  
  ```docker
  docker run -d -p 8080:80 nginx
  ```
    
  - 컨테이너 안에 Nginx 웹 서버가 설치되어 있고, 이 서버가 80번 포트로 웹 페이지를 제공한다고 가정한 경우
  - `p 8080:80`은 호스트의 8080 포트를 컨테이너의 80 포트에 연결
  - 이제 호스트 컴퓨터의 브라우저에서 `http://localhost:8080`으로 접속하면, 컨테이너 내부의 웹 서버(80 포트)에 접근 가능
  <br>
  <br>

### 👉 포트 매핑의 작동 방식

---

- 외부 네트워크에서 호스트의 포트(예 : 8080)로 요청이 들어옴
- Docker는 이 요청을 NAT를 이용해 컨테이너 내부의 포트(예 : 80)로 전달
- 컨테이너가 요청을 처리한 후 응답을 보낼 때도 NAT가 이를 외부 네트워크로 다시 전달
- ⇒ 따라서 외부 사용자는 호스트의 포트만 기억하면 되고, 그 포트에 들어오는 요청은 자동으로 컨테이너로 전송됨
<br>
<br>

### 👉 NAT(Network Address Translation, 네트워크 주소 변환)이란?

---

- NAT는 네트워크에서 주소를 바꿔서 데이터를 전달하는 기술
- Docker에서는 외부 네트워크(예 : 인터넷)와 내부 네트워크(브리지 네트워크)를 연결할 때 이 기술이 사용
- Docker 컨테이너는 브리지 네트워크로 격리되어 있어서, 외부에서 컨테이너의 내부 주소(IP와 포트)를 직접 알 수 없음
    - NAT는 이를 해결하기 위해 외부에서 들어온 요청을 컨테이너 내부로 보내주고, 반대로 컨테이너에서 나가는 요청을 외부로 변환해주는 다리 역할을 함
    <br>
- **NAT의 작동 방식 간단 정리**
    - 패킷이 네트워크를 통과할 때
        - NAT는 네트워크 경계에 위치하여, 데이터 패킷의 출발지 IP/포트 또는 목적지 IP/포트를 변환
        - 이를 통해 내부 네트워크와 외부 네트워크 간의 데이터 흐름을 조율
    - 변환 과정
        - 내부 네트워크에서 외부로 나가는 패킷의 출발지 주소(IP)를 NAT 장비의 외부 IP로 변경
        - 외부 네트워크에서 내부로 들어오는 패킷의 목적지 주소를 NAT 장비가 원래의 내부 IP로 변환
