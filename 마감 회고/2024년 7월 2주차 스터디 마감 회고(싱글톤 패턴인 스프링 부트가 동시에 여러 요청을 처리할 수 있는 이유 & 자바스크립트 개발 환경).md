## 싱글톤 패턴인 스프링 부트가 동시에 여러 요청을 처리할 수 있는 이유

- 질문과 답변
    
    > **🤔 질문 1**
    >
    >  싱글톤 빈을 통해 만들어진 하나의 인스턴스만 사용한다고 되어있는데 동시성에 왜 문제가 있는 것인가
    
    <br>
    
    > **🖥️ 답변 1**
    > 하나의 인스턴스를 사용하지만 여러 스레드가 동시에 접근할 수 있습니다. 그래서 상태가 변할 수 있는 값을 가지고 있다면, 데이터가 뒤죽박죽 섞이는 경우가 생길 수 있습니다.
    >
    > 예시로 계좌 관련 서비스가 있고, 계좌의 잔액을 빈(객체)에서 갖고 있다고 가정해보겠습니다.
    > 스레드 A와 B가 거의 동시에 잔액을 조회해서 1,000이라는 결과를 얻었습니다.
    > A가 여기서 500을 출금한 뒤, 잔액을 500으로 업데이트 했습니다.
    > 스레드 B도 1,000이라는 잔액을 이미 조회했기 때문에, 500을 출금하고 잔액을 500으로 업데이트 합니다.
    > 실제 잔액은 0이 되어야 하지만, 최종적으로 500이라는 값으로 업데이트 되었습니다.
    > 스레드 A와 B는 서로 간섭하지 않았지만, 실제로는 동일한 잔액을 기반으로 작업하여 데이터가 일관성이 없어졌습니다.
    >
    > 또 다른 예시로는, 이 블로그의 3번 부분입니다.
    > 요청이 들어오면, 한 번 print를 하고 3초 간 지연을 시킨 뒤 다시 값을 출력합니다. 그럼 그 3초 사이에 들어온 다음 요청의 값이 serviceString의 값을 변경 시켜 1, b와 같은 결과가 나오게 됩니다.

    <br>

    > **🤔 질문 2**
    >
    > cs적으로 궁금한 점이 싱글톤은 하나의 인스턴스 -> 스레드 풀에 담긴 멀티스레드풀에서의 동작은 어떠한지
    > 동작 과정이 잘 이해가 가질 않습니다.
    > 싱글톤이기에 메모리는 한 공간에서 동작하지만
    > 연산하는 동작은 cpu에서 메모리에 있는 싱글톤 빈의 동작코드를 읽고 연산작업만 하는 형태인가요?

    <br>

    > **🖥️ 답변 2**
    > 싱글톤 빈은 메모리에 단 하나의 인스턴스만 존재하며, 모든 요청이 이 인스턴스를 사용합니다.
    > 스레드 풀은 웹 애플리케이션에서 서블릿 컨테이너가 요청을 처리하기 위해 스레드 풀을 사용합니다. 각 클라이언트 요청은 스레드 풀에서 할당된 스레드에서 처리됩니다.
    >
    > 싱글톤 빈의 메모리 공간은 하나지만, 여러 스레드가 그 빈의 메서드를 동시에 호출할 수 있습니다. 이는 CPU가 메모리에 있는 싱글톤 빈의 코드를 읽어 연산을 수행하는 형태입니다.
    >
    > 애초에, 저도 헷갈렸던 게 하나의 객체가 한 번에 한 요청만 처리할 수 있다고 생각했던 것입니다. 요청을 한 번에 하나만 할지, 여러 개를 할 수 있는 지는 스레드의 개수에 의해 결정됩니다(객체의 메서드에 동기화가 되어 있지 않다면). 그러면 인스턴스는 그 요청을 처리(연산)해서 결과를 return 하는 역할인 것입니다. 이 부분은 언어마다 다른 제한을 갖고 있을 수 있습니다.
